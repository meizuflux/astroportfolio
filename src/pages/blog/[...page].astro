---
import BaseLayout from "../../layouts/BaseLayout.astro"
import { formatDate, sortByYear } from "../../utils"

var allPosts, sortedPosts

export async function getStaticPaths({paginate, rss}) {
  allPosts = Astro.fetchContent('./*.md');
  console.log(allPosts)
  sortedPosts = allPosts.sort((a, b) => new Date(b.modified) - new Date(a.modified));

  // Generate an RSS feed from this collection of posts.
  // NOTE: This is disabled by default, since it requires `buildOptions.site` to be set in your "astro.config.mjs" file.
  //   rss({
  //     title: 'Don’s Blog',
  //     description: 'An example blog on Astro',
  //     customData: `<language>en-us</language>`,
  //     items: sortedPosts.map(item => ({
  //       title: item.title,
  //       description: item.description,
  //       link: item.url,
  //       pubDate: item.date,
  //     })),
  //   });

  // Return a paginated collection of paths for all posts
  return paginate(sortedPosts, {pageSize: 999});
}

const { page } = Astro.props;
const posts = sortByYear(page.data)
---
<BaseLayout title="Blog">
    <h1 style="text-align: center;">blog</h1>

    {(Object.keys(posts).sort((a, b) => b-a)).map((key, index) => (
        <h2>{key}</h2>
        <ul>
            {posts[key].map(p => (
                <li>
                    <a href={p.url}>{p.title}</a> — <time datetime>{formatDate(p.modified)}</time>
                </li>
            ))}
        </ul>
    ))}

</BaseLayout>

